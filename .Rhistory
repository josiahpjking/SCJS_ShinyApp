prevyear=years[length(years)-1] #previous survey year
firstyear=years[1] #first survey year
yn<-c("Yes","No") #yes no choices
getnames<-function(string){
df %>%
filter(grepl(string,variable)) %>%
pull(name_trunc) %>%
unique() %>%
as.character()
}
#variables/variable groupings
all_vars<-list('National Indicators'= getnames("PREVSURVEY|QS2AREA:|DCONF_03"),
'Rates of Crime Victimisation'=getnames("PREV"),
'Confidence in the Police'=getnames("POLCONF"),
'Attitudes to the Police'=getnames("POLOP|COMPOL|POLPRES|RATPOL"),
'Confidence in Scottish Criminal Justice System'=getnames("DCONF"),
'Perceptions of Crime Rates and Safety'=getnames("QS"),
'Worries of Crime'=getnames("QWORR"),
'Worries of Being Harassed'=getnames("HWORR"),
'Perceptions of Local Crime'=getnames("QACO"),
'Perceptions of Local People'=getnames("LCPEOP")
)
df$variable<-df$name_trunc
save.image(file = "./app/.RData")
require(tidyr)
require(dplyr)
require(magrittr)
#setwd("\\\\scotland.gov.uk/dc2/fs4_home/Z613379/pdiv_shiny/v9")
################
#sort out data.
################
#####
#plotting constants
#####
#police division colours
pdivcols=c("Argyll & West Dunbartonshire (L Division)"='#66C2A5',
"Ayrshire (U Division)"='#FC8D62',
"Dumfries & Galloway (V Division)"='#8DA0CB',
"Edinburgh City (E Division)"='#E78AC3',
"Fife (P Division)"='#A6D854',
"Forth Valley (C Division)"='#FFD92F',
"Greater Glasgow (G Division)"='#E5C494',
"Highlands & Islands (N Division)"='#8DD3C7',
"Lanarkshire (Q Division)"='#FB8072',
"Lothians & Scottish Borders (J Division)"='#BEBADA',
"NA"='#FFFFB3',
"North East (A Division)"='#80B1D3',
"Renfrewshire & Inverclyde (K Division)"='#FDB462',
"Tayside (D Division)"='#B3DE69',
"National Average"='#B3B3B3')
#colours for overview page (national avg = black, and up/down/none is included)
overview_cols=c(pdivcols[-length(pdivcols)],
"National Average"='#000000',
"No difference"="#BDBDBD",
"More Positive"="#95fb71",
"Less Positive"="#fb7171",
"Better than average"="#7195fb",
"Worse than average"="#fb9271")
#modebar icons to remove
modebar_remove <- c('hoverClosestCartesian','hoverCompareCartesian','zoom2d','pan2d','toggleSpikelines','select2d','lasso2d','zoomIn2d','zoomOut2d')
#####
#DATA, input choices
#####
#proportion data
df<-readRDS("data/pdiv9.5.test.rds")
#df$wrapped_name <- sapply(df$name_trunc, FUN = function(x) {paste(strwrap(x, width = 20), collapse = "<br>")})
#df$wrappedv <- sapply(df$label, FUN = function(x) {paste(strwrap(x, width = 25), collapse = "<br>")})
des_factors <- df %>% group_by(year) %>% summarise(des_f=first(des_effect)) #design factors
pdivis<-levels(factor(df$police_div)) #police divisions
years=levels(df$year) #years
currentyear=years[length(years)] #latest survey year
prevyear=years[length(years)-1] #previous survey year
firstyear=years[1] #first survey year
yn<-c("Yes","No") #yes no choices
getnames<-function(string){
df %>%
filter(grepl(string,variable)) %>%
pull(name_trunc) %>%
unique() %>%
as.character()
}
#variables/variable groupings
all_vars<-list('National Indicators'= getnames("PREVSURVEY|QS2AREA:|DCONF_03"),
'Rates of Crime Victimisation'=getnames("PREV"),
'Confidence in the Police'=getnames("POLCONF"),
'Attitudes to the Police'=getnames("POLOP|COMPOL|POLPRES|RATPOL"),
'Confidence in Scottish Criminal Justice System'=getnames("DCONF"),
'Perceptions of Crime Rates and Safety'=getnames("QS"),
'Worries of Crime'=getnames("QWORR"),
'Worries of Being Harassed'=getnames("HWORR"),
'Perceptions of Local Crime'=getnames("QACO"),
'Perceptions of Local People'=getnames("LCPEOP")
)
df$variable<-df$name_trunc
save.image(file = "./app/.RData")
require(tidyr)
require(dplyr)
require(magrittr)
#setwd("\\\\scotland.gov.uk/dc2/fs4_home/Z613379/pdiv_shiny/v9")
################
#sort out data.
################
#####
#plotting constants
#####
#police division colours
pdivcols=c("Argyll & West Dunbartonshire (L Division)"='#66C2A5',
"Ayrshire (U Division)"='#FC8D62',
"Dumfries & Galloway (V Division)"='#8DA0CB',
"Edinburgh City (E Division)"='#E78AC3',
"Fife (P Division)"='#A6D854',
"Forth Valley (C Division)"='#FFD92F',
"Greater Glasgow (G Division)"='#E5C494',
"Highlands & Islands (N Division)"='#8DD3C7',
"Lanarkshire (Q Division)"='#FB8072',
"Lothians & Scottish Borders (J Division)"='#BEBADA',
"NA"='#FFFFB3',
"North East (A Division)"='#80B1D3',
"Renfrewshire & Inverclyde (K Division)"='#FDB462',
"Tayside (D Division)"='#B3DE69',
"National Average"='#000000')
#colours for overview page (national avg = black, and up/down/none is included)
overview_cols=c(pdivcols,
"No difference"="#BDBDBD",
"More Positive"="#95fb71",
"Less Positive"="#fb7171",
"Better than average"="#7195fb",
"Worse than average"="#fb9271")
#modebar icons to remove
modebar_remove <- c('hoverClosestCartesian','hoverCompareCartesian','zoom2d','pan2d','toggleSpikelines','select2d','lasso2d','zoomIn2d','zoomOut2d')
#####
#DATA, input choices
#####
#proportion data
df<-readRDS("data/pdiv9.5.test.rds")
#df$wrapped_name <- sapply(df$name_trunc, FUN = function(x) {paste(strwrap(x, width = 20), collapse = "<br>")})
#df$wrappedv <- sapply(df$label, FUN = function(x) {paste(strwrap(x, width = 25), collapse = "<br>")})
des_factors <- df %>% group_by(year) %>% summarise(des_f=first(des_effect)) #design factors
pdivis<-levels(factor(df$police_div)) #police divisions
years=levels(df$year) #years
currentyear=years[length(years)] #latest survey year
prevyear=years[length(years)-1] #previous survey year
firstyear=years[1] #first survey year
yn<-c("Yes","No") #yes no choices
getnames<-function(string){
df %>%
filter(grepl(string,variable)) %>%
pull(name_trunc) %>%
unique() %>%
as.character()
}
#variables/variable groupings
all_vars<-list('National Indicators'= getnames("PREVSURVEY|QS2AREA:|DCONF_03"),
'Rates of Crime Victimisation'=getnames("PREV"),
'Confidence in the Police'=getnames("POLCONF"),
'Attitudes to the Police'=getnames("POLOP|COMPOL|POLPRES|RATPOL"),
'Confidence in Scottish Criminal Justice System'=getnames("DCONF"),
'Perceptions of Crime Rates and Safety'=getnames("QS"),
'Worries of Crime'=getnames("QWORR"),
'Worries of Being Harassed'=getnames("HWORR"),
'Perceptions of Local Crime'=getnames("QACO"),
'Perceptions of Local People'=getnames("LCPEOP")
)
df$variable<-df$name_trunc
save.image(file = "./app/.RData")
require(tidyr)
require(dplyr)
require(magrittr)
#setwd("\\\\scotland.gov.uk/dc2/fs4_home/Z613379/pdiv_shiny/v9")
################
#sort out data.
################
#####
#plotting constants
#####
#police division colours
pdivcols=c("Argyll & West Dunbartonshire (L Division)"='#66C2A5',
"Ayrshire (U Division)"='#FC8D62',
"Dumfries & Galloway (V Division)"='#8DA0CB',
"Edinburgh City (E Division)"='#E78AC3',
"Fife (P Division)"='#A6D854',
"Forth Valley (C Division)"='#FFD92F',
"Greater Glasgow (G Division)"='#E5C494',
"Highlands & Islands (N Division)"='#8DD3C7',
"Lanarkshire (Q Division)"='#FB8072',
"Lothians & Scottish Borders (J Division)"='#BEBADA',
"NA"='#FFFFB3',
"North East (A Division)"='#80B1D3',
"Renfrewshire & Inverclyde (K Division)"='#FDB462',
"Tayside (D Division)"='#B3DE69',
"National Average"='#000000')
#colours for overview page (national avg = black, and up/down/none is included)
overview_cols=c(pdivcols,
"No difference"="#BDBDBD",
"More Positive"="#95fb71",
"Less Positive"="#fb7171",
"Better than average"="#95fb71",
"Worse than average"="#fb7171")
#modebar icons to remove
modebar_remove <- c('hoverClosestCartesian','hoverCompareCartesian','zoom2d','pan2d','toggleSpikelines','select2d','lasso2d','zoomIn2d','zoomOut2d')
#####
#DATA, input choices
#####
#proportion data
df<-readRDS("data/pdiv9.5.test.rds")
#df$wrapped_name <- sapply(df$name_trunc, FUN = function(x) {paste(strwrap(x, width = 20), collapse = "<br>")})
#df$wrappedv <- sapply(df$label, FUN = function(x) {paste(strwrap(x, width = 25), collapse = "<br>")})
des_factors <- df %>% group_by(year) %>% summarise(des_f=first(des_effect)) #design factors
pdivis<-levels(factor(df$police_div)) #police divisions
years=levels(df$year) #years
currentyear=years[length(years)] #latest survey year
prevyear=years[length(years)-1] #previous survey year
firstyear=years[1] #first survey year
yn<-c("Yes","No") #yes no choices
getnames<-function(string){
df %>%
filter(grepl(string,variable)) %>%
pull(name_trunc) %>%
unique() %>%
as.character()
}
#variables/variable groupings
all_vars<-list('National Indicators'= getnames("PREVSURVEY|QS2AREA:|DCONF_03"),
'Rates of Crime Victimisation'=getnames("PREV"),
'Confidence in the Police'=getnames("POLCONF"),
'Attitudes to the Police'=getnames("POLOP|COMPOL|POLPRES|RATPOL"),
'Confidence in Scottish Criminal Justice System'=getnames("DCONF"),
'Perceptions of Crime Rates and Safety'=getnames("QS"),
'Worries of Crime'=getnames("QWORR"),
'Worries of Being Harassed'=getnames("HWORR"),
'Perceptions of Local Crime'=getnames("QACO"),
'Perceptions of Local People'=getnames("LCPEOP")
)
df$variable<-df$name_trunc
save.image(file = "./app/.RData")
require(tidyr)
require(dplyr)
require(magrittr)
#####
#plotting constants
#####
#police division colours
pdivcols=c("Argyll & West Dunbartonshire (L Division)"='#66C2A5',
"Ayrshire (U Division)"='#FC8D62',
"Dumfries & Galloway (V Division)"='#8DA0CB',
"Edinburgh City (E Division)"='#E78AC3',
"Fife (P Division)"='#A6D854',
"Forth Valley (C Division)"='#FFD92F',
"Greater Glasgow (G Division)"='#E5C494',
"Highlands & Islands (N Division)"='#8DD3C7',
"Lanarkshire (Q Division)"='#FB8072',
"Lothians & Scottish Borders (J Division)"='#BEBADA',
"NA"='#FFFFB3',
"North East (A Division)"='#80B1D3',
"Renfrewshire & Inverclyde (K Division)"='#FDB462',
"Tayside (D Division)"='#B3DE69',
"National Average"='#000000')
#colours for overview page (national avg = black, and up/down/none is included)
overview_cols=c(pdivcols,
"No difference"="#BDBDBD",
"More Positive"="#95fb71",
"Less Positive"="#fb7171",
"Better than average"="#95fb71",
"Worse than average"="#fb7171")
#modebar icons to remove
modebar_remove <- c('hoverClosestCartesian','hoverCompareCartesian','zoom2d','pan2d','toggleSpikelines','select2d','lasso2d','zoomIn2d','zoomOut2d')
#####
#DATA, input choices
#####
#proportion data
df<-readRDS("data/pdiv9.5.test.rds")
des_factors <- df %>% group_by(year) %>% summarise(des_f=first(des_effect)) #design factors
pdivis<-levels(factor(df$police_div)) #police divisions
years=levels(df$year) #years
currentyear=years[length(years)] #latest survey year
prevyear=years[length(years)-1] #previous survey year
firstyear=years[1] #first survey year
yn<-c("Yes","No") #yes no choices
getnames<-function(string){
df %>%
filter(grepl(string,variable)) %>%
pull(name_trunc) %>%
unique() %>%
as.character()
}
#variables/variable groupings
all_vars<-list('National Indicators'= getnames("PREVSURVEY|QS2AREA:|DCONF_03"),
'Rates of Crime Victimisation'=getnames("PREV"),
'Confidence in the Police'=getnames("POLCONF"),
'Attitudes to the Police'=getnames("POLOP|POLPRES|RATPOL"),
'Confidence in Scottish Criminal Justice System'=getnames("DCONF"),
'Perceptions of Crime Rates and Safety'=getnames("QS"),
'Perceptions of Local Crime'=getnames("QACO"),
'Perceptions of Local People'=getnames("LCPEOP"),
'Worries of Crime Victimisation'=getnames("QWORR"),
'Worries of Being Harassed'=getnames("HWORR")
)
df$variable<-df$name_trunc
#### map data
pd_latlon <- readRDS("data/map.Rdata")
#### map data
pd_latlon <- readRDS("data/pd_mapdata.RDS")
df$variable
df %>% filter(year==currentyear, grepl("Victim of any crime",variable)) %>% group_by(police_div) %>%
summarise(
population = first(samplesize_w),
anycrime = first(percentage)
) %>% mutate(PDivName = police_div) %>% left_join(pd_latlon@data, .) -> pd_latlon@data
#### map data
pd_latlon <- readRDS("data/pd_mapdata.RDS")
df %>% filter(year==currentyear, grepl("Victim of any crime",variable)) %>% group_by(police_div) %>%
summarise(
population = first(samplesize_w),
anycrime = first(percentage)
) %>% mutate(
PDivName = police_div,
mytext = paste0("<b>",PDivName,"</b> <br>Population: ",round(population),"<br>Percentage SCJS Crime Victimisation: ",signif(anycrime,3),"%")
) %>% left_join(pd_latlon@data, .) -> pd_latlon@data
save.image(file = "./app/.RData")
require(tidyr)
require(dplyr)
require(magrittr)
#setwd("\\\\scotland.gov.uk/dc2/fs4_home/Z613379/pdiv_shiny/v9")
################
#sort out data.
################
#####
#plotting constants
#####
#police division colours
pdivcols=c("Argyll & West Dunbartonshire (L Division)"='#66C2A5',
"Ayrshire (U Division)"='#FC8D62',
"Dumfries & Galloway (V Division)"='#8DA0CB',
"Edinburgh City (E Division)"='#E78AC3',
"Fife (P Division)"='#A6D854',
"Forth Valley (C Division)"='#FFD92F',
"Greater Glasgow (G Division)"='#E5C494',
"Highlands & Islands (N Division)"='#8DD3C7',
"Lanarkshire (Q Division)"='#FB8072',
"Lothians & Scottish Borders (J Division)"='#BEBADA',
"NA"='#FFFFB3',
"North East (A Division)"='#80B1D3',
"Renfrewshire & Inverclyde (K Division)"='#FDB462',
"Tayside (D Division)"='#B3DE69',
"National Average"='#000000')
#colours for overview page (national avg = black, and up/down/none is included)
overview_cols=c(pdivcols,
"No difference"="#BDBDBD",
"More Positive"="#95fb71",
"Less Positive"="#fb7171")
#modebar icons to remove
modebar_remove <- c('hoverClosestCartesian','hoverCompareCartesian','zoom2d','pan2d','toggleSpikelines','select2d','lasso2d','zoomIn2d','zoomOut2d')
#####
#DATA, input choices
#####
#proportion data
df<-readRDS("data/pdiv9.5.test.rds")
#df$wrapped_name <- sapply(df$name_trunc, FUN = function(x) {paste(strwrap(x, width = 20), collapse = "<br>")})
#df$wrappedv <- sapply(df$label, FUN = function(x) {paste(strwrap(x, width = 25), collapse = "<br>")})
des_factors <- df %>% group_by(year) %>% summarise(des_f=first(des_effect)) #design factors
pdivis<-levels(factor(df$police_div)) #police divisions
years=levels(df$year) #years
currentyear=years[length(years)] #latest survey year
prevyear=years[length(years)-1] #previous survey year
firstyear=years[1] #first survey year
yn<-c("Yes","No") #yes no choices
getnames<-function(string){
df %>%
filter(grepl(string,variable)) %>%
pull(name_trunc) %>%
unique() %>%
as.character()
}
#variables/variable groupings
all_vars<-list('National Indicators'= getnames("PREVSURVEY|QS2AREA:|DCONF_03"),
'Rates of Crime Victimisation'=getnames("PREV"),
'Confidence in the Police'=getnames("POLCONF"),
'Attitudes to the Police'=getnames("POLOP|POLPRES|RATPOL"),
'Confidence in Scottish Criminal Justice System'=getnames("DCONF"),
'Perceptions of Crime Rates and Safety'=getnames("QS"),
'Perceptions of Local Crime'=getnames("QACO"),
'Perceptions of Local People'=getnames("LCPEOP"),
'Worries of Crime Victimisation'=getnames("QWORR"),
'Worries of Being Harassed'=getnames("HWORR")
)
df$variable<-df$name_trunc
#### map data
pd_latlon <- readRDS("data/pd_mapdata.RDS")
df %>% filter(year==currentyear, grepl("Victim of any crime",variable)) %>% group_by(police_div) %>%
summarise(
population = first(samplesize_w),
anycrime = first(percentage)
) %>% mutate(
PDivName = police_div,
mytext = paste0("<b>",PDivName,"</b> <br>Population: ",round(population),"<br>Prevalence of all <br> SCJS Crime: ",signif(anycrime,3),"%")
) %>% left_join(pd_latlon@data, .) -> pd_latlon@data
save.image(file = "./app/.RData")
irvar=all_vars[[1]][1]
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average")
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average") %>%
summary(lm(percentage~as.numeric(year),data=.))
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average") %>%
summary(lm(percentage~year,data=.))
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average")
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average") ->dd
summary(lm(percentage~year,data=dd))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize_w))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
irvar=all_vars[[5]][1]
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average") ->dd
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
irvar=all_vars[[1]][2]
irvar=all_vars[[2]][2]
irvar=all_vars[[2]][1]
df %>% filter(variable %in% irvar) %>% filter(police_div == "National Average") ->dd
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
pdivis[4]
pdivis[5]
df %>% filter(variable %in% irvar) %>% filter(police_div == pdivis[5]) -> dd
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
df %>% filter(variable %in% irvar) %>% filter(police_div == pdivis[1]) -> dd
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
df %>% filter(variable %in% irvar) %>% filter(police_div == pdivis[5]) -> dd
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(lm(percentage~as.numeric(year),data=dd))
dd
dd %>% mutate(
y=rep(1,p*samplesize)
)
d$p*d$samplesize
dd$p*dd$samplesize)
dd$p*dd$samplesize
dd$p
lapply(dd$p*dd$samplesize, function(x) rep(1,x))
c(dd$p*dd$samplesize,dd$samplesize*(1-dd$p))
list(dd$p*dd$samplesize,dd$samplesize*(1-dd$p))
props<-list(dd$p*dd$samplesize,dd$samplesize*(1-dd$p))
lapply(props,print)
lapply(props,function(x) print(props[[x]]))
lapply(seq_along(props),function(x) print(props[[x]]))
lapply(seq_along(props),function(x) print(props[[1]]))
lapply(props, function(x) c(rep(1,props[[1]]),rep(0,props[[2]]))
lapply(props, function(x) c(rep(1,props[[1]]),rep(0,props[[2]])))
ep(1,props[[1]])
rep(1,props[[1]])
rep(1,props[[1]])
lapply(props, function(x) c(rep(1,props[x]),rep(0,props[2])))
lapply(props, function(x) c(rep(1,props[[1]][x]),rep(0,props[[2]][x])))
lapply(seq_along(props), function(x) c(rep(1,props[[1]][x]),rep(0,props[[2]][x])))
years<-lapply(seq_along(props), function(x) c(rep(1,props[[1]][x]),rep(0,props[[2]][x])))
seq_along(props)
years<-lapply(seq_along(props[[1]]), function(x) c(rep(1,props[[1]][x]),rep(0,props[[2]][x])))
years
summary(years)
matrix(unlist(years))
head(matrix(unlist(years)))
lapply(years, data.frame())
lapply(years, data.frame
)
lapply(years, data.frame) %>% head()
as.data.frame(years)
years[1]
cbind("year1",years[1])
cbind("year1",years[[1]])
cbind(1,years[[1]])->y1
cbind(2,years[[2]])->y2
cbind(3,years[[3]])->y3
cbind(4,years[[4]])->y4
cbind(5,years[[5]])->y5
bind_cols(y1,y2)
data.frame(year=1, vals=years[[1]])
data.frame(year=1, vals=years[[1]]) ->y1
data.frame(year=1, vals=years[[1]]) ->y1cbind(2,years[[2]])->y2
data.frame(year=1, vals=years[[1]]) ->y1
data.frame(year=2, vals=years[[2]]) ->y2
data.frame(year=3, vals=years[[3]]) ->y3
data.frame(year=4, vals=years[[4]]) ->y4
data.frame(year=5, vals=years[[5]]) ->y5
bind_cols(y1,y2,y3,y4)
bind_rows(y1,y2,y3,y4)
all<-bind_rows(y1,y2,y3,y4,y5)
summary(glm(vals~year,all))
summary(glm(vals~year,all,family="binomial"))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
summary(glm(vals~year,all,family="binomial"))
df %>% filter(variable %in% irvar) %>% filter(police_div == pdivis[1]) -> dd
props<-list(dd$p*dd$samplesize,dd$samplesize*(1-dd$p))
years<-lapply(seq_along(props[[1]]), function(x) c(rep(1,props[[1]][x]),rep(0,props[[2]][x])))
data.frame(year=1, vals=years[[1]]) ->y1
data.frame(year=2, vals=years[[2]]) ->y2
data.frame(year=3, vals=years[[3]]) ->y3
data.frame(year=4, vals=years[[4]]) ->y4
data.frame(year=5, vals=years[[5]]) ->y5
all<-bind_rows(y1,y2,y3,y4,y5)
summary(glm(vals~year,all,family="binomial"))
summary(lm(percentage~as.numeric(year),data=dd))
summary(lm(percentage~as.numeric(year),data=dd,weights=samplesize))
