year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_imp = ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear)),
thisyear_col = ifelse(thisyear_imp=="up","#95fb71",
ifelse(thisyear_imp=="down","#fb7171","#BDBDBD"))
) %>% select(variable, current_percentage, current_ci, thisyear, thisyear_imp, thisyear_col) -> image_data
image_data %>% filter(grepl("Confident",variable)) -> ni_conf_data
image_data %>% filter(grepl("Victim",variable)) -> ni_crime_data
image_data %>% filter(grepl("Perceived",variable)) -> ni_perc_data
ni_crime_data[,4]
ni_crime_data[,4]
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
?fct_recode
??fct_recode
require(forcats)
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear)),
text = fct_recode(thisyear_direction, "up"="IMPROVING","down"="WORSENING","same"="SAME"),
thisyear_col = ifelse(thisyear_imp=="up","#95fb71",
ifelse(thisyear_imp=="down","#fb7171","#BDBDBD"))
) %>% select(variable, current_percentage, current_ci, thisyear, thisyear_imp, thisyear_col) -> image_data
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear)),
text = fct_recode(thisyear_direction, "IMPROVING"="up","down"="WORSENING","same"="SAME"),
thisyear_col = ifelse(thisyear_imp=="up","#95fb71",
ifelse(thisyear_imp=="down","#fb7171","#BDBDBD"))
) %>% select(variable, current_percentage, current_ci, thisyear, thisyear_imp, thisyear_col) -> image_data
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear)),
text = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same"),
thisyear_col = ifelse(thisyear_imp=="up","#95fb71",
ifelse(thisyear_imp=="down","#fb7171","#BDBDBD"))
) %>% select(variable, current_percentage, current_ci, thisyear, thisyear_imp, thisyear_col) -> image_data
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same"),
thisyear_col = ifelse(thisyear_imp=="up","#95fb71",
ifelse(thisyear_imp=="down","#fb7171","#BDBDBD"))
) %>% select(variable, current_percentage, current_ci, thisyear, thisyear_imp, thisyear_col) -> image_data
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same"),
thisyear_col = ifelse(thisyear_imp=="up","#95fb71",
ifelse(thisyear_imp=="down","#fb7171","#BDBDBD"))
)
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same")
) %>% select(variable, current_percentage, current_ci, thisyear) -> image_data
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same")
)
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text1 = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same"),
text2 = paste0(round(current_percentage,1),text1)
) %>% select(variable, current_percentage, current_ci, thisyear) -> image_data
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text1 = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same"),
text2 = paste0(round(current_percentage,1),text1)
) %>% select(variable, current_percentage, current_ci, thisyear,text2) -> image_data
image_data %>% filter(grepl("Confident",variable))
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text1 = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","SAME"="same"),
text2 = paste(round(current_percentage,1),text1,sep=" ")
) %>% select(variable, current_percentage, current_ci, thisyear,text2) -> image_data
image_data %>% filter(grepl("Confident",variable)) -> ni_conf_data
View(ni_conf_data)
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text1 = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","MAINTAINING"="same"),
text2 = paste(round(current_percentage,1),text1,sep=" ")
) %>% select(variable, current_percentage, current_ci, thisyear,text2) -> image_data
image_data %>% filter(grepl("Confident",variable)) -> ni_conf_data
View(ni_conf_data)
######## national indicator data #########
df %>% filter(police_div=="National Average",
year %in% c(currentyear,prevyear),
variable %in% all_vars[[1]]) %>%
group_by(variable) %>%
summarise(
current_percentage = percentage[which(year==currentyear)],
current_ci = ci[which(year==currentyear)],
p_diff=abs(diff(p)),
c=sqrt(sum(ci^2)),
p_signif=p_diff>c,
rev_coded=first(reverse_coded),
thisyear = ifelse(p_signif==TRUE & year[which(p==min(p))]==currentyear, "down",
ifelse(p_signif==TRUE & year[which(p==min(p))]!=currentyear, "up",
"same")),
thisyear_direction = factor(ifelse(rev_coded==1 & thisyear=="up","down",
ifelse(rev_coded==1 & thisyear=="down","up", thisyear))),
text1 = fct_recode(thisyear_direction, "IMPROVING"="up","WORSENING"="down","MAINTAINING"="same"),
text2 = paste0(round(current_percentage,1),"% ",text1)
) %>% select(variable, current_percentage, current_ci, thisyear,text2) -> image_data
image_data %>% filter(grepl("Confident",variable)) -> ni_conf_data
image_data %>% filter(grepl("Victim",variable)) -> ni_crime_data
image_data %>% filter(grepl("Perceived",variable)) -> ni_perc_data
ni_crime_data[,4]
ni_crime_data
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
require(rsconnect)
terminateApp("sg-scottish-crime-justice-survey","scotland")
terminateApp("sg-scottish-crime-justice-survey","scotland")
terminateApp("sg-scottish-crime-justice-survey","scotland")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
terminateApp("sg-scjs-test","josiahpjking")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
terminateApp("sg-scjs-test","josiahpjking")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
shiny::runApp(appDir="./app/")
